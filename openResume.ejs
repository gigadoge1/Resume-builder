<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create resume</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
        }

        .input-container {
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-control {
            background-color: #1e1e1e;
            color: #fff;
            border-color: #333;
        }

        #printFrame {
            border: 1px solid #333;
            aspect-ratio: 113/160;
        }
    </style>
    <nav id="navbar" class="navbar navbar-dark navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a style="font-weight: bold;font-size:x-large;" class="navbar-brand" href="#">ResuBuild</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div style="width: 300px !important" id="navbarContent" class="offcanvas offcanvas-end bg-dark"
                tabindex="-1">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title text-white">Menu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav ms-auto me-4 mb-2 mb-lg-0 nav-underline ps-4">
                        <li class="nav-item">
                            <a class="nav-link" href="/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/dashboard">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <form method="POST" action="/logout"><button type="submit" class="nav-link">Logout</button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
</head>
<body>
    <div class="container-fluid mt-5">
        <div class="row">
            <div class="col-md-6 mt-4">
                <div class="d-flex flex-column align-items-center">
                    <iframe id="printFrame" style="width: 50%;"></iframe>
                    <div class="mt-3 d-flex gap-2">
                        <input class="form-control" type="text" data-bs-theme="dark" name="nameRes" id="nameRes", placeholder="Enter name of resume..." value="<%= nameOfRes %>">
                        <button class="btn btn-outline-primary" onclick="printContent()">Print</button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mt-4 input-container">
                <form id="form">
                </form>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
        integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
        crossorigin="anonymous"></script>
    <script>
        const iframe = document.getElementById("printFrame");
        const doc = iframe.contentWindow.document;
        let html = `
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <title>Exported Data</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
            <style>
            body {
                padding: 1.5rem;
                background-color: #f8f9fa;
                color: #212529;
                font-size: 0.95rem;
            }
            .section-title {
                font-weight: 600;
                font-size: 1.1rem;
                margin-top: 1.5rem;
                border-bottom: 1px solid #dee2e6;
                padding-bottom: 0.3rem;
            }
            .item {
                margin-bottom: 0.75rem;
            }
            .label {
                font-weight: 500;
            }
            </style>
        </head>
        <body>
            <div class="container-fluid">
        `;
        let acdata = <%- JSON.stringify(data) %>;
        acdata = JSON.parse(acdata.resudata);
        console.log(acdata)
        for(const id in acdata) { 
            if (typeof(acdata[id]) !== "object") { 
                html += `
                <div class="item">
                    <div class="section-title label">${(id.charAt(0).toUpperCase() + id.slice(1)).replace(/([a-z])([A-Z])/g, '$1 $2')}</div>
                    <div id="${id}">${acdata[id]}</div>
                </div>
                `;
            } else {
                html += `<div class="section-title">${(id.charAt(0).toUpperCase() + id.slice(1)).replace(/([a-z])([A-Z])/g, '$1 $2')} </div>`;
                for (const semid in acdata[id]) {
                    html += `
                    <div class="item">
                        <div id="${parseInt(semid)+1}"> ${acdata[id][semid]}></div>
                    </div>
                    `;
                }
            }
        }

        html += `
            </div>
        </body>
        </html>
        `;

        doc.open();
        doc.write(html);
        doc.close();

        function printContent() {
            iframe.contentWindow.print();
        }
        inputs = document.querySelectorAll('.form-control');
        inputs.forEach(input => {
            input.addEventListener('input', (e) => {
                iframe.contentWindow.document.getElementById(input.id).innerHTML = e.target.value;
            });
        });
        window.addEventListener("scroll", () => {
            if (window.pageYOffset >= 35) {
                document.getElementById("navbar").style.backgroundColor = "rgb(31, 31, 31)";
                document.getElementById("navbar").style.borderBottom = "1px solid grey";
            }
            else {
                document.getElementById("navbar").style.backgroundColor = "";
                document.getElementById("navbar").style.borderBottom = "";
            }
        });
    </script>

</body>

</html>